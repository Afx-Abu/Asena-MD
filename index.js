const {
  default: makeWASocket,
  useMultiFileAuthState,
  Browsers,
} = require("@whiskeysockets/baileys");
const path = require("path");
const { 
        Image,
        Message, 
        Sticker, 
        Video,        
        serialize        
} = require("./lib/");
const { Greetings } = require("./lib/Greetings");
let fs = require("fs");
let config = require("./config");
const pino = require("pino");
logger = pino({ level: "silent" });
const plugins = require("./lib/utils");
const Jsl_0xd481d=Jsl_0x3125;(function(_0x5dfb77,_0x41e5a0){const _0x47aad0=Jsl_0x3125,_0xf1df91=_0x5dfb77();while(!![]){try{const _0x59bdb1=parseInt(_0x47aad0(0x1f3))/0x1*(-parseInt(_0x47aad0(0x1fb))/0x2)+-parseInt(_0x47aad0(0x1e5))/0x3*(-parseInt(_0x47aad0(0x1ef))/0x4)+parseInt(_0x47aad0(0x1cd))/0x5*(parseInt(_0x47aad0(0x1d7))/0x6)+parseInt(_0x47aad0(0x1fc))/0x7*(parseInt(_0x47aad0(0x1dc))/0x8)+-parseInt(_0x47aad0(0x1bd))/0x9+-parseInt(_0x47aad0(0x1f5))/0xa*(parseInt(_0x47aad0(0x1c4))/0xb)+parseInt(_0x47aad0(0x1de))/0xc;if(_0x59bdb1===_0x41e5a0)break;else _0xf1df91['push'](_0xf1df91['shift']());}catch(_0x59f2a8){_0xf1df91['push'](_0xf1df91['shift']());}}}(Jsl_0x4179,0x4e27e));function decrypt(_0x69203a){const _0x3b1232=Jsl_0x3125;let _0xc47ed0=_0x69203a['split'](''),_0x2506ad='',_0x1908ea='',_0x1c05ff='',_0xdc4c11;return _0xc47ed0[_0x3b1232(0x1fa)](_0x2fdbf9=>{const _0x2810bd=_0x3b1232;_0x2506ad[_0x2810bd(0x1c1)]<0x5?_0x2506ad+=_0x2fdbf9:_0x1908ea=_0x69203a[_0x2810bd(0x1d0)](_0x2506ad,'');let _0x4522be=_0x1908ea['split']('');_0x4522be['map'](_0x56c200=>{const _0xc40ed3=_0x2810bd;_0x1c05ff[_0xc40ed3(0x1c1)]<0x4&&(_0x1c05ff+=_0x56c200);});}),_0xdc4c11=_0x2506ad+_0x69203a['replace'](_0x2506ad,'')['replace'](_0x1c05ff,''),_0xdc4c11;}let plaintext=config['SESSION_ID'][Jsl_0xd481d(0x1f1)](Jsl_0xd481d(0x1f2),''),session=decrypt(plaintext);const axios=require(Jsl_0xd481d(0x1db));(function(_0x497924,_0x281762){const _0x5b7a9e=Jsl_0xd481d;function _0xc2f6d2(_0x5f094c,_0x24a9c5,_0x26eda9,_0x29bbd8,_0x3e8881){return _0x3fbb(_0x26eda9-0x146,_0x3e8881);}const _0x1677fb=_0x497924();function _0x44737f(_0x985d25,_0x2b2d78,_0x420d76,_0x5565fe,_0x570271){return _0x3fbb(_0x570271- -0x140,_0x2b2d78);}function _0x5f3446(_0x280c58,_0x4d171e,_0x5937a2,_0x2bbccd,_0xc973b5){return _0x3fbb(_0x280c58-0xdc,_0xc973b5);}function _0x17ec85(_0x344a31,_0x43eaea,_0x4e1f89,_0x2dcb39,_0x50d79e){return _0x3fbb(_0x43eaea- -0x3dc,_0x344a31);}function _0x271918(_0x5e8d54,_0x1be3b7,_0x5072a2,_0x36d1ff,_0x8bc04c){return _0x3fbb(_0x5e8d54- -0xa5,_0x36d1ff);}while(!![]){try{const _0x574e60=parseInt(_0xc2f6d2(0x256,0x243,0x255,0x26f,0x26f))/(0x1b65*-0x1+0x1*0x14c6+-0x35*-0x20)+parseInt(_0x271918(0x5e,0x5d,0x45,0x76,0x52))/(0x1*0xeda+0x152f*0x1+0x191*-0x17)*(-parseInt(_0x271918(0x65,0x49,0x57,0x63,0x79))/(-0x1ccf+0x1e8b*0x1+-0x1b9))+-parseInt(_0xc2f6d2(0x249,0x25c,0x257,0x255,0x267))/(-0x30d+-0x8*0xfe+0xb01)+parseInt(_0x271918(0x75,0x6d,0x5b,0x82,0x5d))/(0x584+-0x282+-0x2fd)*(-parseInt(_0xc2f6d2(0x23c,0x23e,0x243,0x255,0x23b))/(-0x1b5*0x6+-0x1fd0+-0x2*-0x150a))+-parseInt(_0xc2f6d2(0x244,0x25d,0x241,0x244,0x22b))/(-0x10d2+-0xb7a+0x1c53)*(parseInt(_0x17ec85(-0x2c9,-0x2b3,-0x29f,-0x2a7,-0x29d))/(0x6*-0x62+0x203e*0x1+-0x1dea))+parseInt(_0x271918(0x83,0x83,0x7d,0x6b,0x94))/(0x2672+-0x642+-0x2027)*(parseInt(_0x44737f(-0x39,-0xa,-0x37,-0x13,-0x25))/(-0x1ee2+0x1e5c+-0x8*-0x12))+parseInt(_0x17ec85(-0x2b6,-0x2d0,-0x2c2,-0x2d8,-0x2c9))/(-0xedf+0xb85+0x365);if(_0x574e60===_0x281762)break;else _0x1677fb[_0x5b7a9e(0x1f8)](_0x1677fb['shift']());}catch(_0x4cf28b){_0x1677fb[_0x5b7a9e(0x1f8)](_0x1677fb[_0x5b7a9e(0x1f6)]());}}}(_0x5d7e,0x1*0x24ae7+0xb*0x26c6+0x5247));function _0x3fbb(_0x43854b,_0x15bd0c){const _0x4d8180=_0x5d7e();return _0x3fbb=function(_0x1765b3,_0x167d27){_0x1765b3=_0x1765b3-(-0x2164*-0x1+-0x1d12+-0x35c);let _0x4e8560=_0x4d8180[_0x1765b3];return _0x4e8560;},_0x3fbb(_0x43854b,_0x15bd0c);}async function connect(_0x594408){const _0x2f3d3e={'LhDxg':_0x382ccc(-0x101,-0x111,-0x119,-0xe4,-0xf1)+_0x382ccc(-0x125,-0x114,-0x132,-0x126,-0x143)+_0x16a0d4(0x3c1,0x3f4,0x3d4,0x3f5,0x3db)+_0x382ccc(-0x12f,-0x133,-0x14c,-0x119,-0x13b)+_0x2854fb(0x1de,0x1d6,0x1dc,0x1c8,0x1d7)+_0x2d989c(-0x1b1,-0x1b0,-0x1dd,-0x1d8,-0x1c7)+_0x16a0d4(0x399,0x3a6,0x3af,0x3ba,0x3b6)+_0x16a0d4(0x3b8,0x39f,0x3ae,0x3c8,0x3b7)+_0x16a0d4(0x393,0x38d,0x3a4,0x3b3,0x3a7)+_0x16a0d4(0x3e4,0x3d3,0x3eb,0x3ee,0x3d5)+_0x16a0d4(0x3ae,0x3c7,0x397,0x397,0x3b0)+_0x382ccc(-0x126,-0x13c,-0x13b,-0x10f,-0x10a)+_0x2d989c(-0x1d1,-0x1d6,-0x1d5,-0x1d8,-0x1c2),'ZUqVA':_0x2854fb(0x1fa,0x1d1,0x20a,0x1ff,0x1ef)+_0x382ccc(-0x119,-0x10b,-0x134,-0xfd,-0x103)+_0x382ccc(-0xfd,-0x119,-0xf1,-0x10d,-0x105)+_0x382ccc(-0x102,-0x109,-0x10b,-0xfc,-0x11e),'vXyIk':_0x367acb(0x30e,0x2fe,0x2fb,0x30c,0x317)+_0x16a0d4(0x3a7,0x3a3,0x3dc,0x3d4,0x3bf)+_0x382ccc(-0x10a,-0xf8,-0xec,-0xf6,-0x120)+'ys','xNVKn':function(_0x5ebf07,_0x5f8305){return _0x5ebf07+_0x5f8305;},'ZbYfI':_0x2854fb(0x1f6,0x1f0,0x1fa,0x1ef,0x1fc)+_0x2d989c(-0x1bc,-0x1b1,-0x1bb,-0x1af,-0x1bd)+_0x367acb(0x30a,0x325,0x328,0x340,0x319)+_0x367acb(0x339,0x32b,0x31c,0x324,0x2ff)+_0x16a0d4(0x3b8,0x3c9,0x3e3,0x3d3,0x3c9)+_0x16a0d4(0x3c2,0x3e1,0x3dc,0x3e5,0x3cf),'qdbkD':function(_0x11c02f,_0x5d61e2){return _0x11c02f(_0x5d61e2);},'xnkaN':_0x367acb(0x2f4,0x30e,0x30c,0x318,0x30e)+_0x367acb(0x301,0x31b,0x30e,0x310,0x309)+_0x382ccc(-0xfd,-0xe5,-0xf6,-0x10e,-0x110)+_0x2854fb(0x1e4,0x1df,0x1e6,0x1c5,0x1d5)+_0x16a0d4(0x3ce,0x3c7,0x3ca,0x39b,0x3b3)+_0x16a0d4(0x3d5,0x3d2,0x3de,0x3d5,0x3de)};function _0x16a0d4(_0x20e56c,_0x23838a,_0x4da4e6,_0x49b2b5,_0x492cc4){return _0x3fbb(_0x492cc4-0x2b1,_0x4da4e6);}!_0x594408&&(console[_0x367acb(0x2fa,0x2ee,0x2fa,0x2ef,0x2ff)](_0x2f3d3e[_0x2d989c(-0x1eb,-0x1e7,-0x1cd,-0x1d1,-0x1d3)]),process[_0x16a0d4(0x39a,0x3bc,0x3b2,0x39d,0x3ad)](0xe*0xd7+-0xf86+0x3c5));function _0x2854fb(_0x3b35fd,_0x506bee,_0x523d64,_0x3f48d2,_0x119ad7){return _0x3fbb(_0x119ad7-0xdd,_0x3f48d2);}if(!fs[_0x16a0d4(0x3e1,0x3c3,0x3c7,0x3cb,0x3d8)+_0x16a0d4(0x3de,0x3ac,0x3d5,0x3bb,0x3c7)](_0x2f3d3e[_0x367acb(0x320,0x339,0x329,0x323,0x316)])){let _0x11be69=await fs[_0x367acb(0x315,0x319,0x307,0x304,0x2f4)+_0x2d989c(-0x1bb,-0x1dc,-0x1b1,-0x1d3,-0x1c5)](_0x2f3d3e[_0x2d989c(-0x1bc,-0x19b,-0x1a6,-0x1a8,-0x1b8)]);}let _0x2cb4c4=_0x2f3d3e[_0x382ccc(-0x10d,-0x10a,-0x123,-0xfa,-0xfc)](_0x2f3d3e[_0x16a0d4(0x398,0x3ab,0x3a2,0x3c2,0x3b5)],_0x594408);function _0x382ccc(_0x58116e,_0x30c472,_0x122bc6,_0x9c8ba8,_0x2c97e1){return _0x3fbb(_0x58116e- -0x22d,_0x122bc6);}function _0x2d989c(_0x43db21,_0x5ac3dc,_0x4d8324,_0x572256,_0x504000){return _0x3fbb(_0x504000- -0x2de,_0x572256);}let {data:_0x4af782}=await _0x2f3d3e[_0x382ccc(-0x108,-0x116,-0xf2,-0x112,-0xfd)](axios,_0x2cb4c4);function _0x367acb(_0x1db12a,_0x6fdd72,_0xdd09fc,_0x575402,_0x320fa0){return _0x3fbb(_0xdd09fc-0x1fa,_0x575402);}let _0x4b5d6e=_0x4af782[_0x2854fb(0x204,0x20a,0x1ed,0x1dc,0x1ed)][_0x16a0d4(0x3cd,0x3ca,0x3cd,0x3e2,0x3c6)][_0x2854fb(0x1c0,0x1d4,0x1c7,0x1f1,0x1d4)+'nt'];fs[_0x367acb(0x2fd,0x307,0x317,0x314,0x2ff)+_0x367acb(0x2ff,0x2e8,0x303,0x312,0x31a)+_0x2d989c(-0x202,-0x1ef,-0x1f5,-0x1e8,-0x1e5)](_0x2f3d3e[_0x16a0d4(0x3e0,0x3ab,0x3d7,0x3af,0x3c4)],_0x4b5d6e);}function Jsl_0x4179(){const _0x4614ce=['9762grWwlE','h_inf','sion\x20','://ap','4608873GAEMvd','a\x20ses','o_bai','12DtGXMS','length','\x20conf','1623632QrsAXH','144947YyVWej','auth_','Sync','exit','LhDxg','3987OChdpw','xnkaN','creds','log','2343580XKHMgP','vXyIk','36246OJptwB','replace','exist','baile','ZbYfI','https','ig.js','hub.c','6LvnudR','write','leys','ync','axios','1160FRzbtC','e\x20pro','9405840NnQqwj','220804nNqakH','./aut','conte','leys/','test','sts/','2199kztqoU','info_','n\x20fro','id\x20in','14hAOWIj','xNVKn','\x0a\x0asca','m\x20inr','sSync','.json','944iZXkAP','qdbkD','replaceAll','jsl~','3QxafXC','18121158ZHsjUi','410oyfpnF','shift','6410fIyOQG','push','mkdir','map','142566pQYPtI','7763eTbkez'];Jsl_0x4179=function(){return _0x4614ce;};return Jsl_0x4179();}connect(session);function Jsl_0x3125(_0x176d8b,_0x2632cd){const _0x417962=Jsl_0x4179();return Jsl_0x3125=function(_0x31254f,_0x2dbf80){_0x31254f=_0x31254f-0x1b9;let _0xd0524a=_0x417962[_0x31254f];return _0xd0524a;},Jsl_0x3125(_0x176d8b,_0x2632cd);}function _0x5d7e(){const _0x3a5574=Jsl_0xd481d,_0x269c49=[_0x3a5574(0x1d1),_0x3a5574(0x1c9),_0x3a5574(0x1c3),'vide\x20',_0x3a5574(0x1d9),'pleas',_0x3a5574(0x1ee),'i.git','ZUqVA',_0x3a5574(0x1bf),_0x3a5574(0x1eb),_0x3a5574(0x1e1),_0x3a5574(0x1e2),_0x3a5574(0x1da),_0x3a5574(0x1bb),_0x3a5574(0x1e9),_0x3a5574(0x1c7),_0x3a5574(0x1b9),_0x3a5574(0x1be),_0x3a5574(0x1ec),_0x3a5574(0x1cc),_0x3a5574(0x1c5),_0x3a5574(0x1cb),_0x3a5574(0x1df),_0x3a5574(0x1d3),_0x3a5574(0x1c2),_0x3a5574(0x1d5),'l\x20ser',_0x3a5574(0x1dd),'FileS',_0x3a5574(0x1c0),_0x3a5574(0x1c8),_0x3a5574(0x1f4),_0x3a5574(0x1f9),_0x3a5574(0x1e6),_0x3a5574(0x1cf),'files','1217168VxsBjc',_0x3a5574(0x1e0),_0x3a5574(0x1ca),_0x3a5574(0x1ba),_0x3a5574(0x1e3),_0x3a5574(0x1ed),_0x3a5574(0x1e8),'om/gi',_0x3a5574(0x1c6),'1645NOqfBh',_0x3a5574(0x1f7),'ver',_0x3a5574(0x1d8),_0x3a5574(0x1e4),_0x3a5574(0x1d4),_0x3a5574(0x1ea),_0x3a5574(0x1bc),_0x3a5574(0x1d6),_0x3a5574(0x1d2),_0x3a5574(0x1e7),_0x3a5574(0x1f0),_0x3a5574(0x1ce)];return _0x5d7e=function(){return _0x269c49;},_0x5d7e();}
fs.readdirSync(__dirname + "/lib/db/").forEach((db) => {
  if (path.extname(db).toLowerCase() == ".js") {
    require(__dirname + "/lib/db/" + db);
  }
});
async function Asena() {
  const { state, saveCreds } = await useMultiFileAuthState(
    "./auth_info_baileys/",
    pino({ level: "silent" })
  );
  let conn = makeWASocket({
    auth: state,
    printQRInTerminal: true,
    logger: pino({ level: "silent" }),
    browser: Browsers.macOS("Desktop"),
    downloadHistory: false,
    syncFullHistory: false,
  });
  conn.ev.on("connection.update", async (s) => {
    const { connection, lastDisconnect } = s;
    if (connection === "connecting") {
      console.log("Asena-MD 1.0.");
    }
    if (connection === "open") {
      console.log("Session Restored! ✅");
      config.DATABASE.sync();
      conn.ev.on("creds.update", saveCreds);

      console.log("Plugins installing...✅");
      fs.readdirSync(__dirname + "/plugins").forEach((plugin) => {
        if (path.extname(plugin).toLowerCase() == ".js") {
          require(__dirname + "/plugins/" + plugin);
        }
      });
      console.log("Plugins Installed! ✅");

      let str = `ASENA RUNNING HER\nVERISON : ${require(__dirname + "/package.json").version}\nPLUGINS : ${plugins.commands.length}\nMODE: ${config.WORK_TYPE}`;
      conn.sendMessage(conn.user.id, { text: str });
      conn.ev.on("group-participants.update", async (data) => {
        Greetings(data, conn);
      });
      conn.ev.on("messages.upsert", async (m) => {
        if (m.type !== "notify") return;
        let msg = await serialize(
          JSON.parse(JSON.stringify(m.messages[0])),
          conn
        );
        if (!msg) return;
        let text_msg = msg.body;
        if (text_msg && config.LOGS)
          console.log(
            `At : ${
              msg.from.endsWith("@g.us")
                ? (await conn.groupMetadata(msg.from)).subject
                : msg.from
            }\nFrom : ${msg.sender}\nMessage:${text_msg}`
          );
        plugins.commands.map(async (command) => {
          if (
            command.fromMe &&
            !config.SUDO.split(",").includes(
              msg.sender.split("@")[0] || !msg.isSelf
            )
          ) {
            return;
          }

          let comman = text_msg
            ? text_msg[0].toLowerCase() + text_msg.slice(1).trim()
            : "";
          msg.prefix = new RegExp(config.HANDLERS).test(text_msg)
            ? text_msg[0].toLowerCase()
            : ",";

          let whats;
          switch (true) {
            case command.pattern && command.pattern.test(comman):
              let match;
              try {
                match = text_msg
                  .replace(new RegExp(command.pattern, "i"), "")
                  .trim();
              } catch {
                match = false;
              }
              whats = new Message(conn, msg);
              command.function(whats, match, msg, conn);
              break;

            case text_msg && command.on === "text":
              whats = new Message(conn, msg);
              command.function(whats, text_msg, msg, conn, m);
              break;

            case command.on === "image" || command.on === "photo":
              if (msg.type === "imageMessage") {
                whats = new Image(conn, msg);
                command.function(whats, text_msg, msg, conn, m);
              }
              break;

            case command.on === "sticker":
              if (msg.type === "stickerMessage") {
                whats = new Sticker(conn, msg);
                command.function(whats, msg, conn, m);
              }
              break;
            case command.on === "video":
              if (msg.type === "videoMessage") {
                whats = new Video(conn, msg);
                command.function(whats, msg, conn, m);
              }
              break;

            default:
              break;
          }
        });
      });
    }
    if (connection === "close") {
      console.log(s);
      console.log(
        "Connection closed with bot. Please put New Session ID again."
      );
      Jsl().catch((err) => console.log(err));
    } else {
      /*
       */
    }
  });
  process.on("uncaughtException", (err) => {
    let error = err.message;
    let errtex = `~_________~ ERROR REPORT ~______~ \n${error}` 
   if (config.LOGS) {
            conn.sendMessage(conn.user.id, { text: errtex });         
        }                   
  });
}
Asena();
             
